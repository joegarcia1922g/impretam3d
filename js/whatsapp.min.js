(() => {
  let popupOpen = false;
  const p = "528334318725",
    q = (e) => e.preventDefault();
  addEventListener("click", (e) => {
    if (!e.target.closest(".whatsapp-button") || popupOpen) return;
    q(e);
    popupOpen = true;
    const d = document.createElement("div");
    d.className = "whatsapp-popup";
    d.innerHTML = '<div class="whatsapp-popup-content"><div class="whatsapp-header"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt=""><h3>Contactar por WhatsApp</h3><button type="button" class="close-btn">&times;</button></div><form id="whatsappForm"><input type="text" id="whatsappName" placeholder="Tu nombre" required><input type="tel" id="whatsappPhone" placeholder="Tu número de WhatsApp" pattern="[0-9]{10}" required><textarea id="whatsappMessage" placeholder="Tu mensaje" required></textarea><button type="submit"><img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="">Contactar ahora</button></form></div>';
    document.body.appendChild(d);
    d.addEventListener("click", e => e.stopPropagation());
    const closeBtn = d.querySelector(".close-btn");
    const closePopup = () => {
      if (!popupOpen) return;
      d.remove();
      document.removeEventListener("click", o, true);
      document.removeEventListener("keydown", k, true);
      popupOpen = false;
    };
    closeBtn.addEventListener("click", closePopup);
    const o = (e) => { if (!d.contains(e.target)) closePopup(); };
    const k = (e) => { if (e.key === "Escape") closePopup(); };
    setTimeout(() => {
      document.addEventListener("click", o, true);
      document.addEventListener("keydown", k, true);
      d.querySelector("input").focus();
    }, 10);
    const form = d.querySelector("form");
    form.onsubmit = (e) => {
      q(e);
      const name = form.querySelector("#whatsappName").value.trim();
      const phone = form.querySelector("#whatsappPhone").value.trim();
      const msg = form.querySelector("#whatsappMessage").value.trim();
      if (!name || !phone || !msg) return alert("Por favor completa todos los campos"), !1;
      if (!/^\d{10}$/.test(phone)) return alert("Por favor ingresa un número válido de 10 dígitos"), !1;
      const text = `*Nuevo mensaje de:* ${name}\n*Teléfono:* ${phone}\n\n*Mensaje:*\n${msg}`;
      closePopup();
      location.href = `https://wa.me/${p}?text=${encodeURIComponent(text)}`;
      return !1;
    };
  });
})();
